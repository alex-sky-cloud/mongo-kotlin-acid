# Подходы к синхронизации подписок

Эта папка содержит документацию по 4 различным подходам к синхронизации подписок с внешним сервисом.

## Список подходов

1. **[Подход 1: Batch операции (saveAll)](./APPROACH_1.md)** - Простой подход с batch сохранением через `saveAll()`
2. **[Подход 2: Flow с batch обработкой](./APPROACH_2.md)** - Реактивная обработка через Kotlin Flow с группировкой в батчи
3. **[Подход 3: Оптимизированные нативные запросы](./APPROACH_3.md)** - Использование оптимизированных запросов MongoDB с транзакциями
4. **[Подход 4: Транзакционная обработка](./APPROACH_4.md)** - Атомарная обработка всех операций в транзакции
5. **[Подход 5: Транзакции с явным readConcern=SNAPSHOT](./APPROACH_5.md)** - Явное указание readConcern=SNAPSHOT через transaction labels

## Общая информация

Все подходы реализуют одну и ту же бизнес-логику:
1. Получение данных от внешнего сервиса
2. Загрузка существующих подписок из MongoDB
3. Сравнение по `publicId` (UUID)
4. Обновление существующих записей
5. Создание новых записей
6. Batch сохранение через `saveAll()`

## Endpoints

- `POST /api/subscriptions/sync/approach1` - Подход 1
- `POST /api/subscriptions/sync/approach2` - Подход 2
- `POST /api/subscriptions/sync/approach3` - Подход 3
- `POST /api/subscriptions/sync/approach4` - Подход 4
- `POST /api/subscriptions/sync/approach5` - Подход 5

Все endpoints требуют заголовок `AUTH-USER-ID` с ID клиента.

## Выбор подхода

- **Подход 1** - для простых случаев с небольшим количеством подписок
- **Подход 2** - для больших объемов данных с реактивной обработкой
- **Подход 3** - для production окружений с оптимизацией запросов и транзакциями
- **Подход 4** - для критически важных операций с гарантией атомарности
- **Подход 5** - для критически важных операций с явным указанием readConcern=SNAPSHOT (рекомендуется)

